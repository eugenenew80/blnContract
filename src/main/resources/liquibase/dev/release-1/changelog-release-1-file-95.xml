<?xml version="1.0" encoding="UTF-8"?>

<databaseChangeLog
xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.3.xsd">

<changeSet id="plan-rus-1" logicalFilePath="path-independent" author="ruslan" context="dev">
	<comment>Creating table: plan_volume_ee_headers</comment>
	<createTable tableName="plan_volume_ee_headers" schemaName="apps" remarks="Прогнозные объемы ЭЭ: заголовок">
		<column name="id" type="number" remarks="Идентификатор">
			<constraints nullable="false"/>
		</column>

		<column name="consumer_id" type="number" remarks="Потребитель">
			<constraints nullable="false"/>
		</column>

		<column name="contract_id" type="number" remarks="Ид договора">
			<constraints nullable="false"/>
		</column>

		<column name="gjs_id" type="number" remarks="Вид услуги">
			<constraints nullable="true"/>
		</column>

		<column name="energy_sources_id" type="number" remarks="Ид электростанции">
			<constraints nullable="true"/>
		</column>

		<column name="year" type="number" remarks="год прогноза">
			<constraints nullable="true"/>
		</column>

		<column name="unit_id" type="number" remarks="еденица измерения">
			<constraints nullable="true"/>
		</column>

		<column name="state" type="varchar2(20)" remarks="Статус">
			<constraints nullable="true"/>
		</column>

		<column name="org_id" type="number" remarks="Филиал">
			<constraints nullable="true"/>
		</column>

		<column name="contract_type" type="Varchar2(10)" remarks="Тип контракта">
			<constraints nullable="true"/>
		</column>

		<column name="is_plan_using" type="number" remarks="Признак, определяющий использования данных в составлении Планов. По-умолчанию = 0">
			<constraints nullable="true"/>
		</column>

		<column name="prediction_val_h_id" type="number" remarks="Идентификатор Заголовок прогнозных данных в ЛК">
			<constraints nullable="true"/>
		</column>

		<column name="user_id" type="number" remarks="Исполнитель (id пользователя, может быть внешний или внутренний пользователь)">
			<constraints nullable="true"/>
		</column>

		<column name="create_by" type="number" remarks="Автор">
			<constraints nullable="true"/>
		</column>

		<column name="create_date" type="TIMESTAMP" remarks="Дата создания">
			<constraints nullable="true"/>
		</column>

		<column name="last_update_by" type="number" remarks="Автор обновления">
			<constraints nullable="true"/>
		</column>

		<column name="last_update_date" type="TIMESTAMP" remarks="Дата обновления">
			<constraints nullable="true"/>
		</column>
	</createTable>
</changeSet>

<changeSet id="plan-rus-2" logicalFilePath="path-independent" author="ruslan" context="dev">
	<comment>Creating primary key for table: plan_volume_ee_headers</comment>
	<addPrimaryKey
			columnNames="id"
			constraintName="pk_plan_volume_ee_headers"
			schemaName="apps"
			tableName="plan_volume_ee_headers"/>
</changeSet>

<changeSet id="plan-rus-3" logicalFilePath="path-independent" author="ruslan" context="dev">
	<comment>Creating sequence for table: plan_volume_ee_headers</comment>
	<createSequence
			incrementBy="1"
			schemaName="apps"
			sequenceName="plan_volume_ee_headers_s"
			startValue="1"/>
</changeSet>

<changeSet id="plan-rus-4" logicalFilePath="path-independent" author="ruslan" context="dev">
	<comment>Creating index for table: plan_volume_ee_headers</comment>
	<createIndex indexName="idx_plan_volume_ee_headers_1"
				 schemaName="apps"
				 tableName="plan_volume_ee_headers">
		<column name="consumer_id" type="number"/>
	</createIndex>
</changeSet>

<changeSet id="plan-rus-5" logicalFilePath="path-independent" author="ruslan">
	<comment>Creating foreign constraint: plan_volume_ee_headers to dict_business_partners</comment>
	<addForeignKeyConstraint
			baseTableSchemaName="apps"
			baseTableName="plan_volume_ee_headers"
			baseColumnNames="consumer_id"
			constraintName="fk_plan_volume_ee_headers_1"
			deferrable="true"
			initiallyDeferred="true"
			onDelete="RESTRICT"
			onUpdate="RESTRICT"
			referencedTableSchemaName="apps"
			referencedTableName="dict_business_partners"
			referencedColumnNames="id"
	/>
</changeSet>

<changeSet id="plan-rus-6" logicalFilePath="path-independent" author="ruslan" context="dev">
	<comment>Creating index for table: plan_volume_ee_headers</comment>
	<createIndex indexName="idx_plan_volume_ee_headers_2"
				 schemaName="apps"
				 tableName="plan_volume_ee_headers">
		<column name="contract_id" type="number"/>
	</createIndex>
</changeSet>

<changeSet id="plan-rus-7" logicalFilePath="path-independent" author="ruslan">
	<comment>Creating foreign constraint: plan_volume_ee_headers to cm_doc_keg_cte</comment>
	<addForeignKeyConstraint
			baseTableSchemaName="apps"
			baseTableName="plan_volume_ee_headers"
			baseColumnNames="contract_id"
			constraintName="fk_plan_volume_ee_headers_2"
			deferrable="true"
			initiallyDeferred="true"
			onDelete="RESTRICT"
			onUpdate="RESTRICT"
			referencedTableSchemaName="apps"
			referencedTableName="cm_doc_keg_cte"
			referencedColumnNames="id"
	/>
</changeSet>

<changeSet id="plan-rus-8" logicalFilePath="path-independent" author="ruslan" context="dev">
	<comment>Creating index for table: plan_volume_ee_headers</comment>
	<createIndex indexName="idx_plan_volume_ee_headers_3"
				 schemaName="apps"
				 tableName="plan_volume_ee_headers">
		<column name="gjs_id" type="number"/>
	</createIndex>
</changeSet>

<changeSet id="plan-rus-9" logicalFilePath="path-independent" author="ruslan">
	<comment>Creating foreign constraint: plan_volume_ee_headers to dict_gjs</comment>
	<addForeignKeyConstraint
			baseTableSchemaName="apps"
			baseTableName="plan_volume_ee_headers"
			baseColumnNames="gjs_id"
			constraintName="fk_plan_volume_ee_headers_3"
			deferrable="true"
			initiallyDeferred="true"
			onDelete="RESTRICT"
			onUpdate="RESTRICT"
			referencedTableSchemaName="apps"
			referencedTableName="dict_gjs"
			referencedColumnNames="id"
	/>
</changeSet>

<changeSet id="plan-rus-10" logicalFilePath="path-independent" author="ruslan" context="dev">
	<comment>Creating index for table: plan_volume_ee_headers</comment>
	<createIndex indexName="idx_plan_volume_ee_headers_4"
				 schemaName="apps"
				 tableName="plan_volume_ee_headers">
		<column name="energy_sources_id" type="number"/>
	</createIndex>
</changeSet>

<changeSet id="plan-rus-11" logicalFilePath="path-independent" author="ruslan">
	<comment>Creating foreign constraint: plan_volume_ee_headers to dict_energy_sources</comment>
	<addForeignKeyConstraint
			baseTableSchemaName="apps"
			baseTableName="plan_volume_ee_headers"
			baseColumnNames="energy_sources_id"
			constraintName="fk_plan_volume_ee_headers_4"
			deferrable="true"
			initiallyDeferred="true"
			onDelete="RESTRICT"
			onUpdate="RESTRICT"
			referencedTableSchemaName="apps"
			referencedTableName="dict_energy_sources"
			referencedColumnNames="id"
	/>
</changeSet>

<changeSet id="plan-rus-12" logicalFilePath="path-independent" author="ruslan" context="dev">
	<comment>Creating index for table: plan_volume_ee_headers</comment>
	<createIndex indexName="idx_plan_volume_ee_headers_5"
				 schemaName="apps"
				 tableName="plan_volume_ee_headers">
		<column name="unit_id" type="number"/>
	</createIndex>
</changeSet>

<changeSet id="plan-rus-13" logicalFilePath="path-independent" author="ruslan">
	<comment>Creating foreign constraint: plan_volume_ee_headers to dict_units</comment>
	<addForeignKeyConstraint
			baseTableSchemaName="apps"
			baseTableName="plan_volume_ee_headers"
			baseColumnNames="unit_id"
			constraintName="fk_plan_volume_ee_headers_5"
			deferrable="true"
			initiallyDeferred="true"
			onDelete="RESTRICT"
			onUpdate="RESTRICT"
			referencedTableSchemaName="apps"
			referencedTableName="dict_units"
			referencedColumnNames="id"
	/>
</changeSet>

<changeSet id="plan-rus-14" logicalFilePath="path-independent" author="ruslan" context="dev">
	<comment>Creating index for table: plan_volume_ee_headers</comment>
	<createIndex indexName="idx_plan_volume_ee_headers_6"
				 schemaName="apps"
				 tableName="plan_volume_ee_headers">
		<column name="state" type="varchar2(20)"/>
	</createIndex>
</changeSet>

<changeSet id="plan-rus-15" logicalFilePath="path-independent" author="ruslan">
	<comment>Creating foreign constraint: plan_volume_ee_headers to wf_states</comment>
	<addForeignKeyConstraint
			baseTableSchemaName="apps"
			baseTableName="plan_volume_ee_headers"
			baseColumnNames="state"
			constraintName="fk_plan_volume_ee_headers_6"
			deferrable="true"
			initiallyDeferred="true"
			onDelete="RESTRICT"
			onUpdate="RESTRICT"
			referencedTableSchemaName="apps"
			referencedTableName="wf_states"
			referencedColumnNames="code"
	/>
</changeSet>

<changeSet id="plan-rus-16" logicalFilePath="path-independent" author="ruslan" context="dev">
	<comment>Creating index for table: plan_volume_ee_headers</comment>
	<createIndex indexName="idx_plan_volume_ee_headers_7"
				 schemaName="apps"
				 tableName="plan_volume_ee_headers">
		<column name="org_id" type="number"/>
	</createIndex>
</changeSet>

<changeSet id="plan-rus-17" logicalFilePath="path-independent" author="ruslan">
	<comment>Creating foreign constraint: plan_volume_ee_headers to dict_organizations</comment>
	<addForeignKeyConstraint
			baseTableSchemaName="apps"
			baseTableName="plan_volume_ee_headers"
			baseColumnNames="org_id"
			constraintName="fk_plan_volume_ee_headers_7"
			deferrable="true"
			initiallyDeferred="true"
			onDelete="RESTRICT"
			onUpdate="RESTRICT"
			referencedTableSchemaName="apps"
			referencedTableName="dict_organizations"
			referencedColumnNames="id"
	/>
</changeSet>

<changeSet id="plan-rus-18" logicalFilePath="path-independent" author="ruslan" context="dev">
	<comment>Creating index for table: plan_volume_ee_headers</comment>
	<createIndex indexName="idx_plan_volume_ee_headers_8"
				 schemaName="apps"
				 tableName="plan_volume_ee_headers">
		<column name="contract_type" type="varchar2(10)"/>
	</createIndex>
</changeSet>

<changeSet id="plan-rus-19" logicalFilePath="path-independent" author="ruslan">
	<comment>Creating foreign constraint: plan_volume_ee_headers to cm_contract_type</comment>
	<addForeignKeyConstraint
			baseTableSchemaName="apps"
			baseTableName="plan_volume_ee_headers"
			baseColumnNames="contract_type"
			constraintName="fk_plan_volume_ee_headers_8"
			deferrable="true"
			initiallyDeferred="true"
			onDelete="RESTRICT"
			onUpdate="RESTRICT"
			referencedTableSchemaName="apps"
			referencedTableName="cm_contract_type"
			referencedColumnNames="code"
	/>
</changeSet>

<changeSet id="plan-rus-20" logicalFilePath="path-independent" author="ruslan" context="dev">
	<comment>Creating index for table: plan_volume_ee_headers</comment>
	<createIndex indexName="idx_plan_volume_ee_headers_9"
				 schemaName="apps"
				 tableName="plan_volume_ee_headers">
		<column name="prediction_val_h_id" type="number"/>
	</createIndex>
</changeSet>

<changeSet id="plan-rus-21" logicalFilePath="path-independent" author="ruslan">
	<comment>Creating foreign constraint: plan_volume_ee_headers to pa_req_prediction_val_h</comment>
	<addForeignKeyConstraint
			baseTableSchemaName="apps"
			baseTableName="plan_volume_ee_headers"
			baseColumnNames="prediction_val_h_id"
			constraintName="fk_plan_volume_ee_headers_9"
			deferrable="true"
			initiallyDeferred="true"
			onDelete="RESTRICT"
			onUpdate="RESTRICT"
			referencedTableSchemaName="apps"
			referencedTableName="pa_req_prediction_val_h"
			referencedColumnNames="id"
	/>
</changeSet>

<changeSet id="plan-rus-22" logicalFilePath="path-independent" author="ruslan" context="dev">
	<comment>Creating table: plan_volume_ee_lines</comment>
	<createTable tableName="plan_volume_ee_lines" schemaName="apps" remarks="Прогнозные объемы ЭЭ: строки">
		<column name="id" type="number" remarks="Идентификатор">
			<constraints nullable="false"/>
		</column>

		<column name="header_id" type="number" remarks="Ид заголовка">
			<constraints nullable="false"/>
		</column>

		<column name="val_date" type="TIMESTAMP" remarks="Время прогнозного обьема">
			<constraints nullable="false"/>
		</column>

		<column name="val" type="number" remarks="Обьем">
			<constraints nullable="true"/>
		</column>

		<column name="create_by" type="number" remarks="Автор">
			<constraints nullable="true"/>
		</column>

		<column name="create_date" type="TIMESTAMP" remarks="Дата создания">
			<constraints nullable="true"/>
		</column>

		<column name="last_update_by" type="number" remarks="Автор обновления">
			<constraints nullable="true"/>
		</column>

		<column name="last_update_date" type="TIMESTAMP" remarks="Дата обновления">
			<constraints nullable="true"/>
		</column>
	</createTable>
</changeSet>

<changeSet id="plan-rus-23" logicalFilePath="path-independent" author="ruslan" context="dev">
	<comment>Creating primary key for table: plan_volume_ee_lines</comment>
	<addPrimaryKey
			columnNames="id"
			constraintName="pk_plan_volume_ee_lines"
			schemaName="apps"
			tableName="plan_volume_ee_lines"/>
</changeSet>

<changeSet id="plan-rus-24" logicalFilePath="path-independent" author="ruslan" context="dev">
	<comment>Creating sequence for table: plan_volume_ee_lines</comment>
	<createSequence
			incrementBy="1"
			schemaName="apps"
			sequenceName="plan_volume_ee_lines_s"
			startValue="1"/>
</changeSet>

<changeSet id="plan-rus-25" logicalFilePath="path-independent" author="ruslan" context="dev">
	<comment>Creating index for table: plan_volume_ee_lines</comment>
	<createIndex indexName="idx_plan_volume_ee_lines_1"
				 schemaName="apps"
				 tableName="plan_volume_ee_lines">
		<column name="header_id" type="number"/>
	</createIndex>
</changeSet>

<changeSet id="plan-rus-26" logicalFilePath="path-independent" author="ruslan">
	<comment>Creating foreign constraint: plan_volume_ee_lines to plan_volume_ee_headers</comment>
	<addForeignKeyConstraint
			baseTableSchemaName="apps"
			baseTableName="plan_volume_ee_lines"
			baseColumnNames="header_id"
			constraintName="fk_plan_volume_ee_lines_1"
			deferrable="true"
			initiallyDeferred="true"
			onDelete="RESTRICT"
			onUpdate="RESTRICT"
			referencedTableSchemaName="apps"
			referencedTableName="plan_volume_ee_headers"
			referencedColumnNames="id"
	/>
</changeSet>

	<changeSet id="plan-rus-27" logicalFilePath="path-independent" author="ruslan" context="dev">
		<comment>add column to plan_volume_ee_headers</comment>
		<addColumn schemaName="apps"
				   tableName="plan_volume_ee_headers">
			<column name="plan_type" type="varchar2(20)" remarks="Тип периода на год/5 лет"/>
		</addColumn>
	</changeSet>

	<changeSet id="plan-rus-28" logicalFilePath="path-independent" author="ruslan">
		<comment>Creating foreign constraint: plan_volume_ee_headers to pa_prediction_val_types</comment>
		<addForeignKeyConstraint
				baseTableSchemaName="apps"
				baseTableName="plan_volume_ee_headers"
				baseColumnNames="plan_type"
				constraintName="fk_plan_volume_ee_headers_10"
				deferrable="true"
				initiallyDeferred="true"
				onDelete="RESTRICT"
				onUpdate="RESTRICT"
				referencedTableSchemaName="apps"
				referencedTableName="pa_prediction_val_types"
				referencedColumnNames="code"
		/>
	</changeSet>

	<changeSet id="plan-rus-29" logicalFilePath="path-independent" author="ruslan" context="dev">
		<comment>Creating table: plan_curator_settings_headers</comment>
		<createTable tableName="plan_curator_settings_headers" schemaName="apps" remarks="Настройки филиал куратор заголовок">
			<column name="id" type="number" remarks="Идентификатор">
				<constraints nullable="false"/>
			</column>

			<column name="org_id" type="number" remarks="Ид филиала">
				<constraints nullable="false"/>
			</column>

			<column name="user_id" type="number" remarks="Ид куратора">
				<constraints nullable="true"/>
			</column>

			<column name="create_by" type="number" remarks="Автор">
				<constraints nullable="true"/>
			</column>

			<column name="create_date" type="TIMESTAMP" remarks="Дата создания">
				<constraints nullable="true"/>
			</column>

			<column name="last_update_by" type="number" remarks="Автор обновления">
				<constraints nullable="true"/>
			</column>

			<column name="last_update_date" type="TIMESTAMP" remarks="Дата обновления">
				<constraints nullable="true"/>
			</column>
		</createTable>
	</changeSet>

	<changeSet id="plan-rus-30" logicalFilePath="path-independent" author="ruslan" context="dev">
		<comment>Creating primary key for table: plan_curator_settings_headers</comment>
		<addPrimaryKey
				columnNames="id"
				constraintName="pk_plan_curator_settings_headers"
				schemaName="apps"
				tableName="plan_curator_settings_headers"/>
	</changeSet>

	<changeSet id="plan-rus-31" logicalFilePath="path-independent" author="ruslan" context="dev">
		<comment>Creating sequence for table: plan_curator_settings_headers</comment>
		<createSequence
				incrementBy="1"
				schemaName="apps"
				sequenceName="plan_curator_settings_headers_s"
				startValue="1"/>
	</changeSet>

	<changeSet id="plan-rus-32" logicalFilePath="path-independent" author="ruslan" context="dev">
		<comment>Creating index for table: plan_curator_settings_headers</comment>
		<createIndex indexName="idx_plan_curator_settings_headers_1"
					 schemaName="apps"
					 tableName="plan_curator_settings_headers">
			<column name="org_id" type="number"/>
		</createIndex>
	</changeSet>

	<changeSet id="plan-rus-33" logicalFilePath="path-independent" author="ruslan">
		<comment>Creating foreign constraint: plan_curator_settings_headers to dict_organizations</comment>
		<addForeignKeyConstraint
				baseTableSchemaName="apps"
				baseTableName="plan_curator_settings_headers"
				baseColumnNames="org_id"
				constraintName="fk_plan_curator_settings_headers_1"
				deferrable="true"
				initiallyDeferred="true"
				onDelete="RESTRICT"
				onUpdate="RESTRICT"
				referencedTableSchemaName="apps"
				referencedTableName="dict_organizations"
				referencedColumnNames="id"
		/>
	</changeSet>

	<changeSet id="plan-rus-34" logicalFilePath="path-independent" author="ruslan" context="dev">
		<comment>Creating table: plan_curator_settings_lines</comment>
		<createTable tableName="plan_curator_settings_lines" schemaName="apps" remarks="Настройки филиал куратор: строки">
			<column name="id" type="number" remarks="Идентификатор">
				<constraints nullable="false"/>
			</column>

			<column name="header_id" type="number" remarks="Ид заголовка">
				<constraints nullable="false"/>
			</column>

			<column name="bp_id" type="number" remarks="Идентификатор потребителя (бизнес партнера)">
				<constraints nullable="true"/>
			</column>

			<column name="create_by" type="number" remarks="Автор">
				<constraints nullable="true"/>
			</column>

			<column name="create_date" type="TIMESTAMP" remarks="Дата создания">
				<constraints nullable="true"/>
			</column>

			<column name="last_update_by" type="number" remarks="Автор обновления">
				<constraints nullable="true"/>
			</column>

			<column name="last_update_date" type="TIMESTAMP" remarks="Дата обновления">
				<constraints nullable="true"/>
			</column>
		</createTable>
	</changeSet>

	<changeSet id="plan-rus-35" logicalFilePath="path-independent" author="ruslan" context="dev">
		<comment>Creating primary key for table: plan_curator_settings_lines</comment>
		<addPrimaryKey
				columnNames="id"
				constraintName="pk_plan_curator_settings_lines"
				schemaName="apps"
				tableName="plan_curator_settings_lines"/>
	</changeSet>

	<changeSet id="plan-rus-36" logicalFilePath="path-independent" author="ruslan" context="dev">
		<comment>Creating sequence for table: plan_curator_settings_lines</comment>
		<createSequence
				incrementBy="1"
				schemaName="apps"
				sequenceName="plan_curator_settings_lines_s"
				startValue="1"/>
	</changeSet>

	<changeSet id="plan-rus-37" logicalFilePath="path-independent" author="ruslan" context="dev">
		<comment>Creating index for table: plan_curator_settings_lines</comment>
		<createIndex indexName="idx_plan_curator_settings_lines_1"
					 schemaName="apps"
					 tableName="plan_curator_settings_lines">
			<column name="header_id" type="number"/>
		</createIndex>
	</changeSet>

	<changeSet id="plan-rus-38" logicalFilePath="path-independent" author="ruslan">
	<comment>Creating foreign constraint: plan_curator_settings_lines to plan_curator_settings_headers</comment>
	<addForeignKeyConstraint
			baseTableSchemaName="apps"
			baseTableName="plan_curator_settings_lines"
			baseColumnNames="header_id"
			constraintName="fk_plan_curator_settings_lines_1"
			deferrable="true"
			initiallyDeferred="true"
			onDelete="RESTRICT"
			onUpdate="RESTRICT"
			referencedTableSchemaName="apps"
			referencedTableName="plan_curator_settings_headers"
			referencedColumnNames="id"
	/>
	</changeSet>
	<changeSet id="plan-rus-39" logicalFilePath="path-independent" author="ruslan" context="dev">
		<comment>Creating index for table: plan_curator_settings_lines</comment>
		<createIndex indexName="idx_plan_curator_settings_lines_2"
					 schemaName="apps"
					 tableName="plan_curator_settings_lines">
			<column name="bp_id" type="number"/>
		</createIndex>
	</changeSet>

	<changeSet id="plan-rus-40" logicalFilePath="path-independent" author="ruslan">
	<comment>Creating foreign constraint: plan_curator_settings_lines to dict_business_partners</comment>
	<addForeignKeyConstraint
			baseTableSchemaName="apps"
			baseTableName="plan_curator_settings_lines"
			baseColumnNames="bp_id"
			constraintName="fk_plan_curator_settings_lines_2"
			deferrable="true"
			initiallyDeferred="true"
			onDelete="RESTRICT"
			onUpdate="RESTRICT"
			referencedTableSchemaName="apps"
			referencedTableName="dict_business_partners"
			referencedColumnNames="id"
	/>
	</changeSet>
</databaseChangeLog>
